# 📋 Web UI 完善任務清單

**專案**: Spec-Sync SSOT Web UI  
**開始日期**: 2025-11-13  
**目標**: 完成完整的 Web UI 功能,實現所有 6 個主要頁面  

---

## 🎯 第一階段: 核心功能 MVP (必要)

### ✅ 已完成

- [x] 基礎架構建立 (Flask + Vue 3)
- [x] 路由與導航設定
- [x] SSOT 編輯器完整實作
- [x] 文件產生器完整實作
- [x] Pinia 狀態管理 (ssot, generator)
- [x] 後端 API 基礎端點

---

### 🔲 待完成

#### **任務 1: 實作欄位對應編輯器** 
**優先級**: ⭐⭐⭐⭐⭐ (最高)  
**預估時間**: 4-6 小時  
**負責人**: _______  
**開始日期**: _______  
**完成日期**: _______  

**功能需求**:
- [ ] 左側: SSOT 欄位樹狀結構顯示
  - [ ] 使用 `el-tree` 組件
  - [ ] 支援展開/收合
  - [ ] 顯示完整路徑 (如 `product.name`)
  
- [ ] 右側: 客戶模板書籤列表
  - [ ] 從模板掃描書籤
  - [ ] 顯示書籤名稱與位置
  
- [ ] 拖拉連線功能
  - [ ] 實作 HTML5 Drag & Drop 或 Vue Draggable
  - [ ] Canvas/SVG 繪製連線
  - [ ] 視覺化顯示對應關係
  
- [ ] 資料持久化
  - [ ] 儲存到 `mapping/customer_mapping.yaml`
  - [ ] 載入現有對應關係
  - [ ] 驗證對應正確性

**後端支援**:
- [ ] `GET /api/ssot/flatten` - 扁平化 SSOT 結構
- [ ] `GET /api/templates/{name}/bookmarks` - 掃描書籤
- [ ] `POST /api/mapping` - 儲存對應表

**檔案路徑**: `web-ui/frontend/src/views/MappingEditor.vue`

**技術參考**:
- Element Plus Tree: https://element-plus.org/en-US/component/tree.html
- Vue Draggable: https://github.com/SortableJS/vue.draggable.next

**測試項目**:
- [ ] 能正確載入 SSOT 樹狀結構
- [ ] 能顯示模板書籤列表
- [ ] 拖拉功能正常運作
- [ ] 儲存的 YAML 格式正確
- [ ] 重新載入後對應關係保持

---

#### **任務 2: 實作模板管理頁面**
**優先級**: ⭐⭐⭐⭐  
**預估時間**: 3-4 小時  
**負責人**: _______  
**開始日期**: _______  
**完成日期**: _______  

**功能需求**:
- [ ] 檔案上傳功能
  - [ ] 拖曳上傳區域 (`el-upload`)
  - [ ] 支援 `.docx`, `.xlsx` 格式
  - [ ] 檔案大小限制 (建議 50MB)
  - [ ] 上傳進度顯示
  
- [ ] 模板列表顯示
  - [ ] 表格顯示: 檔名、類型、大小、上傳日期
  - [ ] 排序功能 (名稱、日期、大小)
  - [ ] 搜尋/篩選功能
  
- [ ] 模板操作
  - [ ] 下載原始模板
  - [ ] 刪除模板 (含確認對話框)
  - [ ] 重命名模板
  - [ ] 檢視書籤列表
  
- [ ] 書籤掃描
  - [ ] Word 書籤自動掃描
  - [ ] Excel 命名範圍掃描
  - [ ] 掃描結果顯示

**後端支援**:
- [ ] `POST /api/templates/upload` - 上傳模板
- [ ] `DELETE /api/templates/{name}` - 刪除模板
- [ ] `PUT /api/templates/{name}` - 重命名
- [ ] `GET /api/templates/{name}/bookmarks` - 掃描書籤

**檔案路徑**: `web-ui/frontend/src/views/TemplateManager.vue`

**後端腳本**:
- [ ] 實作 Word 書籤掃描 (使用 python-docx 或 win32com)
- [ ] 實作 Excel 命名範圍掃描 (使用 openpyxl)

**測試項目**:
- [ ] 上傳各種大小的檔案
- [ ] 重複檔名處理
- [ ] 刪除功能正常
- [ ] 書籤掃描準確

---

#### **任務 3: 實作驗證歷史頁面**
**優先級**: ⭐⭐⭐  
**預估時間**: 3-4 小時  
**負責人**: _______  
**開始日期**: _______  
**完成日期**: _______  

**功能需求**:
- [ ] 產生歷史記錄
  - [ ] 時間軸顯示 (`el-timeline`)
  - [ ] 每筆記錄: 時間、引擎、模板、狀態
  - [ ] 可展開查看詳細日誌
  
- [ ] 統計圖表
  - [ ] 成功率趨勢圖 (ECharts 折線圖)
  - [ ] 產生頻率統計 (ECharts 柱狀圖)
  - [ ] 平均產生時間統計
  - [ ] 引擎使用分佈 (ECharts 圓餅圖)
  
- [ ] 一致性驗證
  - [ ] 執行驗證按鈕
  - [ ] 比對結果顯示
  - [ ] 不一致欄位標示
  
- [ ] 錯誤分析
  - [ ] 失敗原因分類
  - [ ] 錯誤訊息查看
  - [ ] 修復建議

**後端支援**:
- [ ] `GET /api/history` - 讀取歷史記錄
- [ ] `GET /api/history/stats` - 統計資料
- [ ] `POST /api/validate` - 執行驗證

**檔案路徑**: `web-ui/frontend/src/views/ValidationHistory.vue`

**技術依賴**:
- [ ] 安裝 ECharts: `npm install echarts`
- [ ] 安裝 Vue-ECharts: `npm install vue-echarts`

**測試項目**:
- [ ] 歷史記錄正確載入
- [ ] 圖表顯示正常
- [ ] 驗證功能運作
- [ ] 資料更新即時反映

---

#### **任務 4: 實作系統設定頁面**
**優先級**: ⭐⭐  
**預估時間**: 2-3 小時  
**負責人**: _______  
**開始日期**: _______  
**完成日期**: _______  

**功能需求**:
- [ ] 引擎設定
  - [ ] 預設引擎模式選擇
  - [ ] Office 安裝路徑設定 (for COM 模式)
  
- [ ] 路徑設定
  - [ ] SSOT 目錄路徑
  - [ ] 模板目錄路徑
  - [ ] 輸出目錄路徑
  - [ ] 路徑驗證功能
  
- [ ] 通知設定
  - [ ] 桌面通知開關
  - [ ] 郵件提醒設定 (選配)
  - [ ] 音效提示開關
  
- [ ] 介面設定
  - [ ] 主題切換 (淺色/深色)
  - [ ] 語言選擇 (中文/英文)
  - [ ] 顯示密度 (寬鬆/標準/緊湊)
  
- [ ] 進階設定
  - [ ] API 超時時間
  - [ ] 快取設定
  - [ ] 除錯模式

**資料儲存**:
- [ ] 前端: LocalStorage (使用者偏好)
- [ ] 後端: 設定檔或資料庫 (系統設定)

**後端支援**:
- [ ] `GET /api/settings` - 讀取設定
- [ ] `PUT /api/settings` - 更新設定

**檔案路徑**: `web-ui/frontend/src/views/SystemSettings.vue`

**測試項目**:
- [ ] 設定儲存與載入
- [ ] 主題切換生效
- [ ] 路徑驗證正確
- [ ] 重新整理後設定保持

---

## 🎯 第二階段: 功能增強 (重要)

#### **任務 5: WebSocket 即時通訊整合**
**優先級**: ⭐⭐⭐⭐  
**預估時間**: 2-3 小時  
**負責人**: _______  
**開始日期**: _______  
**完成日期**: _______  

**功能需求**:
- [ ] Socket.IO 客戶端設定
  - [ ] 安裝 `socket.io-client`
  - [ ] 建立連線管理模組
  - [ ] 自動重連機制
  
- [ ] 事件監聽
  - [ ] `generate_start` - 產生開始
  - [ ] `generate_progress` - 進度更新
  - [ ] `generate_complete` - 產生完成
  - [ ] `generate_error` - 產生錯誤
  - [ ] `ssot_updated` - SSOT 更新
  - [ ] `mapping_updated` - 對應表更新
  
- [ ] UI 整合
  - [ ] DocumentGenerator 進度即時更新
  - [ ] 全域通知提示
  - [ ] 連線狀態指示器

**實作檔案**:
- [ ] `src/utils/socket.js` - Socket 管理
- [ ] `src/composables/useSocket.js` - Vue Composable

**後端檢查**:
- [ ] 確認 Flask-SocketIO 事件發送正確

**測試項目**:
- [ ] 連線建立成功
- [ ] 事件接收正常
- [ ] 斷線重連機制
- [ ] 多瀏覽器同步

---

#### **任務 6: 文件預覽功能**
**優先級**: ⭐⭐⭐  
**預估時間**: 3-4 小時  
**負責人**: _______  
**開始日期**: _______  
**完成日期**: _______  

**功能需求**:
- [ ] PDF 預覽
  - [ ] 後端轉換 Word/Excel 為 PDF
  - [ ] 前端使用 PDF.js 顯示
  - [ ] 縮放、翻頁功能
  
- [ ] 純文字預覽
  - [ ] 提取文件文字內容
  - [ ] 格式化顯示
  
- [ ] 預覽視窗
  - [ ] 模態對話框或側邊欄
  - [ ] 載入動畫
  - [ ] 下載按鈕

**後端支援**:
- [ ] 安裝轉換工具 (docx2pdf / LibreOffice)
- [ ] `GET /api/preview/{filename}` - 預覽端點

**前端依賴**:
- [ ] 安裝 PDF.js: `npm install pdfjs-dist`

**技術選擇**:
- [ ] 方案 A: PDF 轉換 (推薦)
- [ ] 方案 B: Office Online Viewer
- [ ] 方案 C: 純文字顯示

**測試項目**:
- [ ] Word 預覽正常
- [ ] Excel 預覽正常
- [ ] 大檔案處理
- [ ] 特殊格式支援

---

## 🎯 第三階段: 優化功能 (建議)

#### **任務 7: 完善錯誤處理與使用者提示**
**優先級**: ⭐⭐⭐  
**預估時間**: 2-3 小時  
**負責人**: _______  
**開始日期**: _______  
**完成日期**: _______  

**功能需求**:
- [ ] 全域錯誤攔截
  - [ ] Axios Response Interceptor
  - [ ] 統一錯誤訊息格式
  - [ ] 錯誤碼對應表
  
- [ ] 友善提示
  - [ ] 避免技術術語
  - [ ] 提供解決建議
  - [ ] 相關文件連結
  
- [ ] Loading 管理
  - [ ] 全域 Loading 組件
  - [ ] 按鈕 Loading 狀態
  - [ ] 骨架屏 (Skeleton)
  
- [ ] 確認對話框
  - [ ] 刪除操作確認
  - [ ] 覆蓋檔案確認
  - [ ] 離開頁面提示
  
- [ ] 表單驗證
  - [ ] 必填欄位提示
  - [ ] 格式驗證 (路徑、版本號等)
  - [ ] 即時驗證回饋

**實作檔案**:
- [ ] `src/utils/request.js` - Axios 配置
- [ ] `src/utils/errorHandler.js` - 錯誤處理器
- [ ] `src/components/GlobalLoading.vue` - Loading 組件

**測試項目**:
- [ ] 網路錯誤處理
- [ ] 伺服器錯誤處理
- [ ] 表單驗證正確
- [ ] 使用者體驗流暢

---

#### **任務 8: Token 模式與智慧標記整合**
**優先級**: ⭐⭐⭐⭐  
**預估時間**: 2-3 小時  
**負責人**: _______  
**開始日期**: _______  
**完成日期**: _______  

**功能需求**:
- [ ] Token 標記模式
  - [ ] 支援 `{FieldName}` 格式顯示
  - [ ] Token 語法驗證
  - [ ] Token 列表管理
  
- [ ] 整合現有 Python 腳本
  - [ ] 呼叫 `auto_bookmark_helper.py`
  - [ ] 整合 `BatchCreateBookmarks.vba`
  - [ ] Token 自動轉 Bookmark 功能
  
- [ ] 視覺化標記預覽
  - [ ] 在模板中高亮顯示 Token 位置
  - [ ] 標記統計 (已標記/未標記)
  - [ ] 標記覆蓋率檢查
  
- [ ] 模式切換
  - [ ] Token 模式 / Bookmark 模式切換
  - [ ] 批次轉換工具
  - [ ] 轉換記錄保存

**後端支援**:
- [ ] `POST /api/templates/{name}/detect-tokens` - 偵測 Token
- [ ] `POST /api/templates/{name}/convert-tokens` - Token 轉 Bookmark
- [ ] `GET /api/templates/{name}/marking-stats` - 標記統計

**檔案路徑**: 
- `web-ui/frontend/src/views/MappingEditor.vue` (整合 Token 模式)
- `web-ui/frontend/src/components/TokenEditor.vue` (新增)

**技術要點**:
- 正規表達式匹配 `{...}` 格式
- python-docx 或 win32com 插入書籤
- 視覺化顯示標記位置

**測試項目**:
- [ ] Token 語法驗證正確
- [ ] 轉換 Bookmark 功能正常
- [ ] 統計數據準確
- [ ] 模式切換無資料遺失

---

#### **任務 9: SSOT/Mapping 版本控制**
**優先級**: ⭐⭐⭐  
**預估時間**: 3-4 小時  
**負責人**: _______  
**開始日期**: _______  
**完成日期**: _______  

**功能需求**:
- [ ] 自動版本快照
  - [ ] 每次儲存自動建立版本
  - [ ] 版本元資料 (時間、使用者、註解)
  - [ ] 版本編號管理
  
- [ ] 版本歷史檢視
  - [ ] 時間軸顯示所有版本
  - [ ] 版本比較 (Diff 視圖)
  - [ ] 版本詳情查看
  
- [ ] 版本操作
  - [ ] 回退到指定版本
  - [ ] 版本匯出/匯入
  - [ ] 版本標籤/註記
  - [ ] 版本清理 (保留策略)
  
- [ ] Git 整合 (選配)
  - [ ] 自動 Git commit
  - [ ] Commit 訊息自訂
  - [ ] Git push 到遠端
  - [ ] 衝突解決提示

**後端支援**:
- [ ] `GET /api/versions/{type}` - 取得版本列表 (type: ssot/mapping)
- [ ] `GET /api/versions/{type}/{id}` - 取得特定版本
- [ ] `POST /api/versions/{type}/restore` - 還原版本
- [ ] `POST /api/versions/{type}/compare` - 版本比較

**檔案路徑**: 
- `web-ui/frontend/src/views/VersionHistory.vue` (新增)
- `web-ui/frontend/src/components/DiffViewer.vue` (新增)

**技術要點**:
- 版本儲存到 `history/ssot/` 或 `history/mapping/`
- 使用 diff-match-patch 顯示差異
- GitPython 整合 (如果需要)

**測試項目**:
- [ ] 版本自動建立
- [ ] Diff 顯示正確
- [ ] 回退功能正常
- [ ] Git 整合運作 (如有)
  ---

#### **任務 10: 使用者認證與權限管理** (選配)
**優先級**: ⭐⭐  
**預估時間**: 4-5 小時  
**負責人**: _______  
**開始日期**: _______  
**完成日期**: _______  

**功能需求**:
- [ ] 登入功能
  - [ ] 登入表單
  - [ ] JWT Token 管理
  - [ ] 記住我功能
  
- [ ] 使用者角色
  - [ ] 管理員 (所有權限)
  - [ ] 編輯者 (編輯 SSOT、產生文件)
  - [ ] 檢視者 (僅查看)
  
- [ ] 權限控制
  - [ ] 路由守衛
  - [ ] 按鈕權限控制
  - [ ] API 權限驗證
  
- [ ] Session 管理
  - [ ] Token 自動刷新
  - [ ] 登出功能
  - [ ] 多裝置登入管理

**後端支援**:
- [ ] Flask-Login 或 Flask-JWT-Extended
- [ ] 使用者資料庫 (SQLite/PostgreSQL)
- [ ] 權限中介軟體

**前端 Store**:
- [ ] `src/stores/auth.js` - 認證狀態管理

**檔案路徑**: `web-ui/frontend/src/views/Login.vue`

**測試項目**:
- [ ] 登入/登出流程
- [ ] Token 過期處理
- [ ] 權限檢查正確
- [ ] 安全性測試

---

## 🎯 第四階段: 功能增強補充 (選配)

#### **任務 11: 批次操作與匯入匯出**
**優先級**: ⭐⭐  
**預估時間**: 2-3 小時  
**負責人**: _______  
**開始日期**: _______  
**完成日期**: _______  

**功能需求**:
- [ ] 批次文件產生
  - [ ] 選擇多個模板一鍵產生
  - [ ] 批次產生進度顯示
  - [ ] 批次下載 (ZIP 打包)
  
- [ ] 資料匯入/匯出
  - [ ] SSOT 匯出為 JSON/YAML/Excel
  - [ ] 從 Excel 匯入 SSOT 資料
  - [ ] 對應表範本匯出
  - [ ] 對應表批次匯入
  
- [ ] 歷史資料管理
  - [ ] 匯出產生歷史報告 (PDF/Excel)
  - [ ] 清理舊資料功能
  - [ ] 資料備份/還原

**後端支援**:
- [ ] `POST /api/export/ssot` - 匯出 SSOT
- [ ] `POST /api/import/ssot` - 匯入 SSOT  
- [ ] `GET /api/download/batch` - 批次下載 (ZIP)
- [ ] `POST /api/history/export` - 匯出歷史報告

**檔案路徑**: 整合到現有頁面 + `src/components/BatchOperations.vue`

**測試項目**:
- [ ] 批次產生正常
- [ ] ZIP 打包完整
- [ ] 匯入資料正確
- [ ] 格式轉換無誤

---

#### **任務 12: 多人協作與衝突處理**
**優先級**: ⭐⭐  
**預估時間**: 3-4 小時  
**負責人**: _______  
**開始日期**: _______  
**完成日期**: _______  

**功能需求**:
- [ ] 即時協作顯示
  - [ ] 顯示當前編輯者
  - [ ] 編輯鎖定機制
  - [ ] 游標位置同步 (進階)
  
- [ ] 衝突偵測
  - [ ] 檢測併發編輯
  - [ ] 衝突警告提示
  - [ ] 合併工具
  
- [ ] 留言與討論
  - [ ] 針對欄位留言
  - [ ] 討論串顯示
  - [ ] 通知提醒
  
- [ ] 變更追蹤
  - [ ] 顯示誰改了什麼
  - [ ] 變更原因記錄
  - [ ] 變更統計

**後端支援**:
- [ ] WebSocket 廣播編輯狀態
- [ ] Redis 存儲鎖定狀態
- [ ] 資料庫存儲留言

**檔案路徑**: 
- `src/components/CollaborationPanel.vue` (新增)
- `src/components/CommentThread.vue` (新增)

**測試項目**:
- [ ] 多人同時編輯
- [ ] 鎖定機制有效
- [ ] 衝突正確偵測
- [ ] 留言功能正常

---

## 📊 進度追蹤

### 整體完成度

```
總任務數: 12
已完成: 0
進行中: 0
未開始: 12

完成度: [░░░░░░░░░░] 0%
```

### 任務優先級分類

**P0 - 核心必要** (第一階段 MVP):
- 任務 1: 欄位對應編輯器 ⭐⭐⭐⭐⭐
- 任務 2: 模板管理頁面 ⭐⭐⭐⭐
- 任務 3: 驗證歷史頁面 ⭐⭐⭐

**P1 - 重要增強** (第二階段):
- 任務 4: 系統設定頁面 ⭐⭐
- 任務 5: WebSocket 整合 ⭐⭐⭐⭐
- 任務 6: 文件預覽功能 ⭐⭐⭐
- 任務 8: Token 模式整合 ⭐⭐⭐⭐

**P2 - 體驗優化** (第三階段):
- 任務 7: 錯誤處理優化 ⭐⭐⭐
- 任務 9: 版本控制 ⭐⭐⭐

**P3 - 進階選配** (第四階段):
- 任務 10: 使用者認證 ⭐⭐
- 任務 11: 批次操作 ⭐⭐
- 任務 12: 多人協作 ⭐⭐

### 里程碑

- [ ] **Milestone 1**: 核心功能 MVP (任務 1-3) - 目標日期: _______
  - 預估時間: 10-14 小時 (2-3 工作天)
  
- [ ] **Milestone 2**: 功能增強 (任務 4-6, 8) - 目標日期: _______
  - 預估時間: 12-16 小時 (2-3 工作天)
  
- [ ] **Milestone 3**: 體驗優化 (任務 7, 9) - 目標日期: _______
  - 預估時間: 5-7 小時 (1 工作天)
  
- [ ] **Milestone 4**: 進階功能 (任務 10-12) - 目標日期: _______
  - 預估時間: 9-12 小時 (選配)

### 預估總工時

- **核心 MVP** (必要): 10-14 小時
- **完整功能** (含增強): 27-37 小時  
- **全部功能** (含選配): 36-49 小時

---

## 🔄 每日更新

### 2025-11-13
- ✅ 建立 TODO 清單
- ✅ 規劃任務優先級
- ✅ 新增任務 8: Token 模式整合 (專案特色功能)
- ✅ 新增任務 9: 版本控制 (企業必要功能)
- ✅ 新增任務 11-12: 批次操作與協作 (進階功能)
- ✅ 更新里程碑與工時預估
- 📝 準備開始任務 1: 欄位對應編輯器

### _______
- 

---

## 📝 備註

### 技術債務
- [ ] 後端 API 需補充單元測試
- [ ] 前端需加入 E2E 測試 (Cypress 或 Playwright)
- [ ] API 文件需自動生成 (Swagger/OpenAPI)
- [ ] 使用手冊需更新
- [ ] 後端需加入 CORS 白名單設定
- [ ] 檔案上傳需加入病毒掃描

### 已知問題
- [ ] Python 3.13 不支援 gevent/eventlet (已改用 threading 模式)
- [ ] 大檔案上傳可能超時 (需調整 nginx/flask timeout)
- [ ] Word COM 在無 Office 環境無法使用
- [ ] 部分 Emoji 在 PowerShell 顯示亂碼 (已改純文字)

### 效能優化
- [ ] SSOT 大檔案載入優化 (lazy loading)
- [ ] 前端打包體積優化 (code splitting)
- [ ] 圖表渲染優化 (虛擬捲動)
- [ ] API 回應快取 (Redis)

### 未來規劃
- [ ] Docker 容器化部署
- [ ] Kubernetes 編排 (如需高可用)
- [ ] CI/CD 自動化流程 (GitHub Actions)
- [ ] 效能監控與分析 (Prometheus + Grafana)
- [ ] 多語言國際化 (i18n - 英文/簡中/繁中)
- [ ] 行動裝置 App (React Native/Flutter)
- [ ] AI 輔助欄位對應 (LLM 整合)
- [ ] 雲端部署版本 (AWS/Azure/GCP)

---

## 📞 聯絡資訊

**專案負責人**: _______  
**技術支援**: GitHub Issues  
**文件位置**: `docs/` 目錄

---

**最後更新**: 2025-11-13  
**版本**: 1.0.0
